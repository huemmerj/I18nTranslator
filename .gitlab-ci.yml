stages: 
  - build
  - deploy

variables:
  CONTAINER_NAME: translator

build:
  stage: build
  image: node:12.0.0-alpine
  script:
    - apk add --no-cache git automake autoconf alpine-sdk
    - npm config set https-proxy $HTTPS_PROXY
    - npm install
    - npm run build
  artifacts:
    paths:
      - dist
  tags:
    - esalesdocker

deploy:
  stage: deploy
  script:
    - docker stop $CONTAINER_NAME || echo 'Nothing todo'
    - docker rm -f $CONTAINER_NAME || echo 'Nothing todo'
    - cp -R dist /docker_persistent/eSales/translations/dist
    - >
      docker run
      --name $CONTAINER_NAME
      --restart always
      --publish 8990:80
      -v /docker_persistent/eSales/translations/dist:/usr/share/nginx/html
      --detach
      nginx      
  only:
    - master
  tags:
    - shell