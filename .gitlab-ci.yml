stages: 
  - build
  - deploy

variables:
  CONTAINER_NAME: translator

build:
  stage: build
  image: node:12.0.0-alpine
  script:
    - apk add --no-cache git automake autoconf alpine-sdk
    - npm install
    - npm run build
  artifacts:
    paths:
      - dist
  tags:
    - docker

deploy:
  stage: deploy
  script:
    - docker stop $CONTAINER_NAME || echo 'Nothing todo'
    - docker rm -f $CONTAINER_NAME || echo 'Nothing todo'
    - cp -R dist /docker_persistent/eSales/translations
    - >
      docker run
      --name $CONTAINER_NAME
      --restart always
      --publish 8080:8990
      -v /docker_persistent/eSales/translations:/usr/share/nginx/html
      --detach
      nginx      
  tags:
    - translator